{% extends 'admins/home.html' %}
{% load static %}

{% block title %}Transactions{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">All Transactions</h3>

  <div class="table-responsive">
    <table id="transactionsTable" class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Student</th>
          <th>Instructor</th>
          <th>Course</th>
          <th>Amount</th>
          <th>Type</th>
          <th>Description</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for tx in transactions %}
        <tr>
          <td>{{ tx.id }}</td>
          <td>{{ tx.student.username }}</td>
          <td>{% if tx.instructor %}{{ tx.instructor.user.username }}{% else %}-{% endif %}</td>
          <td>{% if tx.course %}{{ tx.course.name }}{% else %}-{% endif %}</td>
          <td>${{ tx.amount|floatformat:0 }}</td>
          <td>
            {% if tx.transaction_type == "credit" %}
              <span class="badge bg-success">Credit</span>
            {% else %}
              <span class="badge bg-danger">Debit</span>
            {% endif %}
          </td>
          <td>{{ tx.description|default:"-" }}</td>
          <td>{{ tx.created_at|date:"Y-m-d H:i" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
  $(document).ready(function() {
    $('#transactionsTable').DataTable({
      "pageLength": 10,
      "order": [[0, "desc"]],
    });
  });
</script>
{% endblock %}


{% comment %} <!-- templates/admins/transactions.html -->
{% extends 'admins/home.html' %}
{% block content %}
<div class="container mt-4">
  <h2>Transactions</h2>

  <!-- Summary -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="card p-3 bg-success text-white">
        <h5>Total Credits</h5>
        <h3>${{ total_credits|floatformat:0 }}</h3>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3 bg-danger text-white">
        <h5>Total Debits</h5>
        <h3>${{ total_debits|floatformat:0 }}</h3>
      </div>
    </div>
  </div>

  <!-- Filter Form -->
  <form method="get" class="mb-3 row">
    <div class="col-md-3">
      <input type="text" name="student" class="form-control" placeholder="Search Student" value="{{ request.GET.student }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="instructor" class="form-control" placeholder="Search Instructor" value="{{ request.GET.instructor }}">
    </div>
    <div class="col-md-3">
      <select name="type" class="form-control">
        <option value="">All</option>
        <option value="credit" {% if request.GET.type == 'credit' %}selected{% endif %}>Credit</option>
        <option value="debit" {% if request.GET.type == 'debit' %}selected{% endif %}>Debit</option>
      </select>
    </div>
    <div class="col-md-3">
      <button type="submit" class="btn btn-primary w-100">Filter</button>
    </div>
  </form>

  <!-- Transactions Table -->
  <div class="card shadow-sm">
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Student</th>
            <th>Instructor</th>
            <th>Course</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          {% for txn in transactions %}
          <tr>
            <td>{{ txn.student.username }}</td>
            <td>{% if txn.instructor %}{{ txn.instructor.user.username }}{% else %}-{% endif %}</td>
            <td>{% if txn.course %}{{ txn.course.title }}{% else %}-{% endif %}</td>
            <td>
              {% if txn.transaction_type == "credit" %}
                <span class="badge bg-success">Credit</span>
              {% else %}
                <span class="badge bg-danger">Debit</span>
              {% endif %}
            </td>
            <td>${{ txn.amount|floatformat:0 }}</td>
            <td>{{ txn.created_at|date:"M d, Y H:i" }}</td>
            <td>{{ txn.description }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center">No transactions found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %} {% endcomment %}
